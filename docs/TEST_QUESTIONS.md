# 1:100万地理数据测试问题集

本文档提供一系列测试问题，用于验证MCP工具和PostgreSQL/PostGIS数据库的功能。这些问题基于1:100万基础地理信息数据集，涵盖不同的查询场景和难度级别。

## 使用说明

1. **测试前准备**：
   - 确保数据库已正确导入数据
   - 使用 `list_tile_codes` 查看可用图幅
   - 使用 `list_tables` 查看可用表
   - 使用 `verify_import` 查看表结构

2. **测试顺序**：
   - 建议从基础问题开始
   - 逐步测试更复杂的查询
   - 记录查询时间和结果准确性

3. **预期结果**：
   - 每个问题都提供了预期的查询方向
   - 实际结果可能因数据版本而异
   - 重点关注查询是否成功执行，而非具体数值

---

## 一、基础查询测试

### 1.1 数据概览

**问题1**：数据库中有多少个表？
- **预期操作**：使用 `list_tables` 工具
- **预期结果**：返回31个表及其基本信息

**问题2**：数据库覆盖了哪些图幅？
- **预期操作**：使用 `list_tile_codes` 工具
- **预期结果**：返回F49、F50、G49、G50四个图幅

**问题3**：每个图幅有多少条记录？
- **预期操作**：使用 `list_tile_codes` 工具
- **预期结果**：显示每个图幅的总记录数

**问题4**：boua表（行政境界面）有多少条记录？
- **预期操作**：使用 `verify_import` 或 `execute_sql`
- **预期结果**：约956条记录

---

## 二、图幅和空间范围测试

### 2.1 图幅范围查询

**问题5**：F49图幅覆盖的经纬度范围是多少？
- **预期操作**：使用 `execute_sql` 查询图幅边界框
- **预期结果**：经度108°-114°，纬度20°-24°

**问题6**：所有图幅的总覆盖面积是多少平方公里？
- **预期操作**：使用 `execute_sql` 计算合并后的总面积
- **预期结果**：约1,081,535平方公里

**问题7**：G50图幅主要覆盖哪些省份？
- **预期操作**：根据图幅范围判断
- **预期结果**：江西、浙江、安徽、福建、湖南

---

## 三、行政区域查询测试

### 3.1 基础行政区域查询

**问题8**：查询惠州市下辖的所有区县名称
- **预期操作**：使用 `execute_sql` 查询boua表，name字段包含"惠"
- **预期结果**：惠城区、惠阳区、惠东县、博罗县、龙门县

**问题9**：惠城区的面积是多少平方公里？
- **预期操作**：使用 `execute_sql`，GROUP BY name，ST_Union合并，ST_Area计算
- **预期结果**：约1,489平方公里

**问题10**：哪些行政区域被分割成了多个部分（跨图幅）？
- **预期操作**：使用 `execute_sql`，GROUP BY name，COUNT(*) > 1
- **预期结果**：返回多个被分割的行政区域

### 3.2 复杂行政区域查询

**问题11**：查询面积最大的前10个区县
- **预期操作**：使用 `execute_sql`，GROUP BY name，ORDER BY area DESC
- **预期结果**：返回面积排序的区县列表

**问题12**：查询位于F49和F50图幅交界处的行政区域
- **预期操作**：使用 `execute_sql`，WHERE tile_code IN ('F49', 'F50')，GROUP BY name，HAVING COUNT(DISTINCT tile_code) > 1
- **预期结果**：返回跨图幅的行政区域

---

## 四、水系查询测试

### 4.1 基础水系查询

**问题13**：惠州范围内有哪些主要水域？
- **预期操作**：使用 `execute_sql` 查询hyda表，空间相交查询
- **预期结果**：东江、潼湖、显岗水库、观洞水库等

**问题14**：白盆珠水库的面积是多少平方公里？
- **预期操作**：使用 `execute_sql`，WHERE name = '白盆珠水库'，ST_Area计算
- **预期结果**：约36.25平方公里

**问题15**：查询面积大于10平方公里的所有水库
- **预期操作**：使用 `execute_sql`，WHERE name LIKE '%水库%'，ST_Area > 10
- **预期结果**：返回多个大型水库

### 4.2 水系统计分析

**问题16**：所有图幅中，水系总面积是多少平方公里？
- **预期操作**：使用 `execute_sql`，SUM(ST_Area)计算hyda表总面积
- **预期结果**：返回总水域面积

**问题17**：查询最长的河流（线状水系）
- **预期操作**：使用 `execute_sql` 查询hydl表，ST_Length计算长度
- **预期结果**：返回最长的河流及其长度

---

## 五、交通网络查询测试

### 5.1 道路查询

**问题18**：F49图幅中有多少条公路记录？
- **预期操作**：使用 `execute_sql`，WHERE tile_code = 'F49'，COUNT(*)
- **预期结果**：约6,038条记录

**问题19**：查询经过惠州的国道编号
- **预期操作**：使用 `execute_sql` 查询lrdl表，空间相交，rn字段
- **预期结果**：返回国道编号列表

**问题20**：计算所有图幅中公路的总长度（公里）
- **预期操作**：使用 `execute_sql`，SUM(ST_Length)计算lrdl表总长度
- **预期结果**：返回总公路长度

### 5.2 铁路查询

**问题21**：G49图幅中有多少条铁路？
- **预期操作**：使用 `execute_sql`，WHERE tile_code = 'G49'，COUNT(*)
- **预期结果**：约175条记录

**问题22**：查询高铁线路（type字段包含"高铁"）
- **预期操作**：使用 `execute_sql` 查询lrrl表，WHERE type LIKE '%高铁%'
- **预期结果**：返回高铁线路列表

---

## 六、保护区查询测试

### 6.1 基础保护区查询

**问题23**：数据库中有多少个自然保护区？
- **预期操作**：使用 `execute_sql` 查询brga表，name LIKE '%自然保护区%'
- **预期结果**：约156个

**问题24**：查询面积最大的前5个自然保护区
- **预期操作**：使用 `execute_sql`，WHERE name LIKE '%自然保护区%'，ORDER BY area DESC
- **预期结果**：返回面积排序的自然保护区

**问题25**：惠州范围内有哪些保护区？
- **预期操作**：使用 `execute_sql`，空间相交查询brga表
- **预期结果**：可能为空或返回少量保护区

### 6.2 保护区分类统计

**问题26**：统计各类保护区的数量（自然保护区、森林公园、风景名胜区等）
- **预期操作**：使用 `execute_sql`，CASE WHEN分类，GROUP BY统计
- **预期结果**：返回各类保护区的数量

**问题27**：查询所有国家级自然保护区
- **预期操作**：使用 `execute_sql`，WHERE name LIKE '%国家级自然保护区%'
- **预期结果**：返回国家级自然保护区列表

---

## 七、居民地查询测试

### 7.1 居民地统计

**问题28**：F50图幅中有多少个居民地（点）？
- **预期操作**：使用 `execute_sql`，WHERE tile_code = 'F50'，COUNT(*)
- **预期结果**：约992个记录

**问题29**：查询面积最大的前10个居民地（面）
- **预期操作**：使用 `execute_sql` 查询resa表，ORDER BY area DESC
- **预期结果**：返回面积排序的居民地

**问题30**：统计每个图幅的居民地数量
- **预期操作**：使用 `execute_sql`，GROUP BY tile_code，COUNT(*)
- **预期结果**：返回每个图幅的居民地统计

---

## 八、植被和地貌查询测试

### 8.1 植被查询

**问题31**：查询面积大于100平方公里的植被区域
- **预期操作**：使用 `execute_sql` 查询vega表，ST_Area > 100
- **预期结果**：返回大面积植被区域

**问题32**：统计各类植被类型的数量
- **预期操作**：使用 `execute_sql`，GROUP BY type，COUNT(*)
- **预期结果**：返回植被类型统计

### 8.2 地貌查询

**问题33**：查询海拔高于1000米的地貌点
- **预期操作**：使用 `execute_sql` 查询terp表，WHERE elev > 1000
- **预期结果**：返回高海拔地貌点

**问题34**：统计等高线的数量（地貌线）
- **预期操作**：使用 `execute_sql`，COUNT(*)查询terl表
- **预期结果**：返回等高线数量

---

## 九、空间分析测试

### 9.1 空间关系查询

**问题35**：查询距离惠州市中心（114.48°E, 23.16°N）50公里内的所有保护区
- **预期操作**：使用 `execute_sql`，ST_Distance计算距离
- **预期结果**：返回附近的保护区

**问题36**：查询与东江相交的所有行政区域
- **预期操作**：使用 `execute_sql`，ST_Intersects空间相交
- **预期结果**：返回与东江相交的行政区域

**问题37**：查询完全位于F49图幅内的行政区域
- **预期操作**：使用 `execute_sql`，ST_Within空间包含
- **预期结果**：返回完全在F49内的区域

### 9.2 缓冲区分析

**问题38**：查询距离主要河流（面积>10km²）5公里内的居民地
- **预期操作**：使用 `execute_sql`，ST_Buffer创建缓冲区，ST_Intersects查询
- **预期结果**：返回缓冲区内的居民地

---

## 十、综合查询测试

### 10.1 多表联合查询

**问题39**：查询同时包含大型水库（>20km²）和自然保护区的行政区域
- **预期操作**：使用 `execute_sql`，多表JOIN，空间相交
- **预期结果**：返回符合条件的行政区域

**问题40**：统计每个行政区域内的水系总面积
- **预期操作**：使用 `execute_sql`，boua表与hyda表空间连接，GROUP BY行政区域
- **预期结果**：返回每个区域的水系面积统计

### 10.2 复杂统计分析

**问题41**：计算每个图幅的各类要素密度（要素数量/图幅面积）
- **预期操作**：使用 `execute_sql`，多表统计，计算密度
- **预期结果**：返回密度统计表

**问题42**：查询跨图幅且面积最大的前5个水系
- **预期操作**：使用 `execute_sql`，GROUP BY name，HAVING COUNT(DISTINCT tile_code) > 1
- **预期结果**：返回跨图幅的大型水系

---

## 十一、边界情况测试

### 11.1 空值和异常处理

**问题43**：查询name字段为空的记录数量（各表）
- **预期操作**：使用 `execute_sql`，WHERE name IS NULL，COUNT(*)
- **预期结果**：返回各表的空值统计

**问题44**：查询几何无效的记录
- **预期操作**：使用 `execute_sql`，WHERE NOT ST_IsValid(geom)
- **预期结果**：返回无效几何记录（应该为0）

**问题45**：查询面积异常大的记录（可能是数据错误）
- **预期操作**：使用 `execute_sql`，ORDER BY area DESC，LIMIT 10
- **预期结果**：检查是否有异常大的面积值

### 11.2 性能测试

**问题46**：测试大范围空间查询的性能（查询整个图幅范围）
- **预期操作**：使用 `execute_sql`，大范围bbox查询，记录查询时间
- **预期结果**：查询应在合理时间内完成（<5秒）

**问题47**：测试复杂空间分析的性能（多表JOIN + 空间计算）
- **预期操作**：使用 `execute_sql`，复杂查询，记录查询时间
- **预期结果**：查询应在合理时间内完成

---

## 十二、数据完整性测试

### 12.1 数据一致性

**问题48**：验证所有表的tile_code字段是否都在可用图幅范围内
- **预期操作**：使用 `execute_sql`，检查tile_code是否在('F49','F50','G49','G50')中
- **预期结果**：所有记录都应在有效图幅内

**问题49**：检查是否有重复的几何对象（相同位置、相同类型）
- **预期操作**：使用 `execute_sql`，ST_Equals比较几何对象
- **预期结果**：检查是否有重复数据

**问题50**：验证坐标系是否正确（所有几何应为SRID 4326）
- **预期操作**：使用 `execute_sql`，检查ST_SRID(geom) = 4326
- **预期结果**：所有几何应为4326坐标系

---

## 测试结果记录模板

建议为每个测试问题记录以下信息：

```
问题编号：[问题X]
测试时间：[YYYY-MM-DD HH:MM:SS]
查询工具：[使用的MCP工具]
查询语句：[SQL语句或工具参数]
执行时间：[秒]
返回结果：[结果摘要]
是否通过：[是/否]
备注：[其他说明]
```

---

## 注意事项

1. **数据限制**：
   - 1:100万比例尺数据分辨率有限，某些细节可能不完整
   - name字段可能为空，需要通过空间位置判断
   - 某些要素可能未标注名称

2. **查询优化**：
   - 始终使用tile_code过滤，提高查询效率
   - 使用空间索引（&&操作符）进行初步过滤
   - 复杂查询考虑使用WITH子句优化

3. **单位转换**：
   - 面积计算必须使用 `ST_Area(geom::geography) / 1000000`（平方公里）
   - 长度计算必须使用 `ST_Length(geom::geography) / 1000`（公里）
   - 不能直接使用shape_area和shape_length字段

4. **行政区域查询**：
   - boua表查询时必须使用GROUP BY和ST_Union合并分割的部分
   - 同一行政区域可能跨多个图幅

5. **测试环境**：
   - 确保数据库连接正常
   - 确保所有图幅数据已正确导入
   - 建议在测试前备份数据库

---

## 相关文档

- [MCP服务指南](MCP_GUIDE.md) - MCP工具使用说明
- [表使用指南](TABLE_USAGE_GUIDE.md) - 各表用途和查询方法
- [字段说明](FIELD_SPEC.md) - 详细字段说明
- [图幅编号指南](TILE_CODE_GUIDE.md) - 图幅编号系统说明
- [查询示例](QUERY_EXAMPLES.md) - 常用查询示例
